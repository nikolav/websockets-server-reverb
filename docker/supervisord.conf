[supervisord]
nodaemon=true
user=root
logfile=/dev/null
; logfile=/dev/stdout
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
childlogdir=/tmp
stopsignal=TERM
stopwaitsecs=20

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[program:redis]
priority=10
command=redis-server --appendonly yes --dir /data --maxmemory 512mb --maxmemory-policy allkeys-lru
autostart=true
autorestart=true
startsecs=1
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0

[program:postgres]
priority=20
; Debian postgres usually wants its own user; we use gosu to drop privileges
command=/bin/sh -c "mkdir -p /var/lib/postgresql/data && chown -R postgres:postgres /var/lib/postgresql && exec gosu postgres /usr/bin/postgres -D /var/lib/postgresql/data"
autostart=true
autorestart=true
startsecs=3
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0

[program:queue]
priority=30
command=/usr/local/bin/php /usr/app/artisan queue:work redis --queue=broadcasts,default --sleep=1 --tries=3 --timeout=90 --memory=256
; command=/usr/local/bin/php /usr/app/artisan queue:work --sleep=1 --tries=3 --timeout=90 --memory=256
directory=/usr/app
autostart=true
autorestart=true
startretries=20
startsecs=2
stopsignal=TERM
stopwaitsecs=3600
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0

[program:reverb]
priority=40
command=/usr/local/bin/php /usr/app/artisan reverb:start --host=0.0.0.0 --port=8080
directory=/usr/app
autostart=true
autorestart=true
startretries=20
startsecs=2
stopsignal=TERM
stopwaitsecs=20
stopasgroup=true
killasgroup=true
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
